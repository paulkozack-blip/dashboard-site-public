# Инструкция по загрузке файлов данных

**Версия:** 1.0  
**Дата:** 30 октября 2025 г.  
**Автор:** Система автоматизации данных  

---

## 1️⃣ Виды загружаемых файлов

Система поддерживает **два типа загрузок**:

| Тип загрузки              | Эндпоинт               | Назначение |
|---------------------------|------------------------|-----------|
| **Линейные данные**       | `/upload`              | Загрузка таблиц с датой, тикером, объёмом и ценой |
| **Свечные данные (Candlestick)** | `/upload-candlestick` | Загрузка свечных данных по отдельным листам Excel-файла |

> **Важно:** Доступ к загрузке файлов имеют **только пользователи с правами администратора**.

---

## 2️⃣ Формат файлов

### Линейные данные (`/upload`)

- **Формат:** Excel (`.xlsx`)
- **Листов:** 1
- **Обязательные столбцы:**

| Столбец  | Описание |
|---------|--------|
| `date`  | Дата наблюдения |
| `ticker`| Название тикера |
| `volume`| Объём |
| `price` | Цена |

> **Ошибка 400:** Если хотя бы один из столбцов отсутствует — загрузка отклоняется.  
> Все строки должны быть заполнены. Пустые или повреждённые записи **не допускаются**.

#### Автоматическое определение группы по тикеру:
| Условие в названии тикера | Группа |
|---------------------------|--------|
| содержит `95`             | **95** |
| содержит `92`             | **92** |
| содержит `ДТ`             | **ДТ** |
| иначе                     | **Other** |

**После загрузки:**
- Данные сохраняются в формате **JSON**
- Для каждого тикера рассчитываются индикаторы: **RSI, EMA и др.**

---

### Свечные данные (`/upload-candlestick`)

- **Формат:** Excel (`.xlsx`)
- **Листов:** несколько (по одному на тикер)
- **Название листа = название тикера**

**Структура таблицы на каждом листе:**

| Столбец  | Описание |
|---------|--------|
| `date`  | Дата |
| `open`  | Цена открытия |
| `high`  | Максимум |
| `low`   | Минимум |
| `close` | Цена закрытия |
| `volume`| Объём |

**После загрузки:**
- Данные по каждому тикеру сохраняются отдельно
- Пересчитываются индикаторы
- Записываются в каталог `data/indicators/`

---

## 3️⃣ Формат даты

| Формат              | Пример         | Примечание |
|---------------------|----------------|-----------|
| `YYYY-MM-DD`        | `2025-10-30`   | **Рекомендуется** |
| Excel-дата (число)  | `45321`        | Автоматически преобразуется |
| `DD.MM.YYYY`        | `30.10.2025`   | Может быть распознана некорректно |

> **Все даты сохраняются в формате `YYYY-MM-DD`**

---

## 4️⃣ Требования к именам файлов

**Разрешено:**
- Буквы (латиница/кириллица)
- Цифры
- Пробелы
- Подчёркивание `_`

**Запрещено:**
- `@ # $ % * ( ) [ ] { } < > ? ! ^ & | ~ \ / : ; ,`

### Примеры корректных имён:
- `data_october.xlsx`
- `candlestick_2025_10.xlsx`
- `данные_октябрь.xlsx`

---

## 5️⃣ Обработка и хранение данных

**После загрузки:**
1. Каждая строка проверяется
2. Добавляется в существующий JSON (если запись новая)
3. Пропускается, если уже существует

**Создаются/обновляются файлы:**